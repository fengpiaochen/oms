Ext.define("Oms.main.HeaderView",{extend:"Ext.container.Container",xtype:"appHeader",id:"app-header",title:"\u8fd0\u8425\u7ba1\u7406\u7cfb\u7edf",height:52,layout:{type:"hbox",align:"middle"},initComponent:function(){document.title=this.title;this.items=[{xtype:"component",id:"app-header-logo"},{xtype:"component",id:"app-header-title",html:this.title,flex:1},{xtype:"profileSwitcher"}];this.callParent()}});
Ext.define("Oms.main.ProfileSwitcher",{extend:"Ext.Component",xtype:"profileSwitcher",cls:"ks-profile-switcher",initComponent:function(){function a(a,b,c){c=Ext.util.Cookies.get("profile");return{profile:a,text:b,checked:c==a,group:"profile",handler:function(){Ext.util.Cookies.set("profile",a,new Date(9999,11));window.location.reload()}}}var b=[],c={triton:"Triton",neptune:"Neptune","neptune-touch":"Neptune Touch",crisp:"Crisp","crisp-touch":"Crisp Touch",classic:"Classic",gray:"Gray"},d;for(profileId in c)b.push(a(profileId,
c[profileId]));d=new Ext.menu.Menu({items:b});this.on({scope:this,click:function(a){d.showBy(this)},element:"el"});this.callParent()}});Ext.define("Oms.main.NavStore",{extend:"Ext.data.TreeStore",alias:"NavStore",constructor:function(a){this.callParent([Ext.apply({root:{text:"\u529f\u80fd\u6982\u89c8",id:"all",expanded:!0,iconCls:"fa-home",children:this.getNavItems()}},a)])},getNavItems:function(){return[{text:"\u7528\u6237\u7ba1\u7406",id:"user",expanded:!0,iconCls:"fa-users",children:[{id:"user-my",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f",leaf:!0},{id:"user-my1",viewClass:"Oms.user.MyView",iconCls:"fa-user",
text:"\u6211\u7684\u4fe1\u606f\u4e00",leaf:!0},{id:"user-my2",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u4e8c",leaf:!0},{id:"user-my3",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u4e09",leaf:!0},{id:"user-my4",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u56db",leaf:!0},{id:"user-my5",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u4e94",leaf:!0},{id:"user-my6",viewClass:"Oms.user.MyView",
iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u516d",leaf:!0},{id:"user-my7",viewClass:"Oms.user.MyView",iconCls:"fa-user",text:"\u6211\u7684\u4fe1\u606f\u4e03",leaf:!0},{id:"user-manager",iconCls:"fa-user-plus",text:"\u7528\u6237\u7ba1\u7406",leaf:!0}]},{text:"\u6743\u9650\u7ba1\u7406",id:"auth",iconCls:"fa-cogs",expanded:!0,children:[{id:"auth-role",iconCls:"fa-male",text:"\u89d2\u8272\u7ba1\u7406",leaf:!0}]}]}});Ext.define("Oms.main.NavTreeView",{extend:"Ext.tree.Panel",xtype:"navigation-tree",id:"navigation-tree",rootVisible:!1,lines:!1,useArrows:!0,hideHeaders:!0,collapseFirst:!1,width:250,minWidth:100,height:200,split:!0,stateful:!0,stateId:"mainnav.west",collapsible:!0,collapseToolText:"\u6298\u53e0\u6b64\u9762\u677f",expandToolText:"\u5c55\u5f00\u6b64\u9762\u677f",bufferedRenderer:!0,title:{text:"\u529f\u80fd\u5bfc\u822a",style:"cursor:pointer",listeners:{click:{element:"el",fn:"navTreeTitleClick"}}},
tools:[{type:"up",tooltip:"\u5207\u6362\u5230\u7b80\u5316\u6a21\u5f0f",listeners:{click:"showBreadcrumbNav"}}],columns:[{xtype:"treecolumn",flex:1,dataIndex:"text",scope:"controller",renderer:"treeNavNodeRenderer"}],bind:{selection:"{selectedView}"},store:"navigation",dockedItems:[{xtype:"textfield",reference:"navtreeFilter",dock:"top",emptyText:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\u641c\u7d22",triggers:{clear:{cls:"x-form-clear-trigger",handler:"onNavFilterClearTriggerClick",hidden:!0,scope:"controller"},
search:{cls:"x-form-search-trigger",weight:1,handler:"onNavFilterSearchTriggerClick",scope:"controller"}},listeners:{change:"onNavFilterFieldChange",buffer:300}}]});Ext.define("Oms.main.ContentPanelView",{extend:"Ext.panel.Panel",xtype:"contentPanel",id:"content-panel",layout:"center",dockedItems:[{xtype:"navigation-toolbar"}],header:{hidden:!0},items:[{xtype:"contentTabs"}],initComponent:function(){Ext.create("Oms.main.ThumbnailsStore",{storeId:"Thumbnails"});this.callParent()}});
Ext.define("Oms.main.Breadcrumb",{extend:"Ext.toolbar.Toolbar",xtype:"navigation-toolbar",reference:"navigation-toolbar",hidden:!0,items:[{xtype:"tool",type:"down",tooltip:"\u5207\u6362\u5230\u5b8c\u6574\u6a21\u5f0f",listeners:{click:"showTreeNav"}},{xtype:"breadcrumb",id:"navigation-breadcrumb",reference:"breadcrumb",bind:{selection:"{selectedView}"},flex:1,showIcons:!0,store:"navigation"}]});Ext.define("Oms.main.ThumbnailsStore",{extend:"Ext.data.Store",model:"Ext.data.TreeModel",proxy:"memory"});
Ext.define("Oms.main.Thumbnails",{extend:"Ext.view.View",id:"thumbnailsView",xtype:"thumbnails",cls:"thumbnails",reference:"contentView",store:"Thumbnails",itemSelector:".thumbnail-item",initComponent:function(){this.tpl='<tpl for="."><div class="thumbnail-item"><div class="thumbnail-icon-wrap bg-'+{crisp:"border-circle","crisp-touch":"circle",neptune:"border-square","neptune-touch":"square",classic:"rounded-square",gray:"rounded-square",triton:"square"}[Ext.util.Cookies.get("profile")]+'"><div class="thumbnail-icon {iconCls}"></div></div><div class="thumbnail-text">{text}</div></div></tpl>';
this.callParent()}});
Ext.define("Oms.main.ContentTabs",{extend:"Ext.tab.Panel",xtype:"contentTabs",id:"contentTabsView",reference:"contentTabsView",width:"100%",height:"100%",defaults:{bodyPadding:10,bodyCls:"oms-panel-body",closable:!0,layout:"center",scrollable:!0},plugins:["tabreorderer","tabclosemenu_zh"],items:[{itemId:"thumbnailsTab",reference:"thumbnailsTab",items:[{selector:"thumbnails",xtype:"thumbnails",reference:"thumbnails"}],closable:!1,listeners:{render:function(a){var b=Ext.StoreMgr.get("navigation").getNodeById("all"),c=
Ext.StoreMgr.get("Thumbnails");c.removeAll();c.add(b.childNodes);a.setTitle(b.get("text"));a.setIconCls(b.get("iconCls"));a.treeNode=b}}}]});Ext.define("Oms.main.TabCloseMenu",{extend:"Ext.ux.TabCloseMenu",alias:"plugin.tabclosemenu_zh",closeTabText:"\u5173\u95ed\u5f53\u524d",closeOthersTabsText:"\u5173\u95ed\u5176\u4ed6",closeAllTabsText:"\u5173\u95ed\u6240\u6709"});Ext.define("Oms.main.GlobalController",{extend:"Ext.app.Controller",alias:"controller.global",routes:{":id":{action:"handleRoute",before:"beforeHandleRoute"}},beforeHandleRoute:function(a,b){var c=this;Ext.StoreMgr.get("navigation").getNodeById(a)?b.resume():(Ext.Msg.alert("\u9519\u8bef","\u60a8\u8bbf\u95ee\u7684\u9875\u9762\u4e0d\u5b58\u5728\uff01",function(){c.redirectTo(c.getApplication().getDefaultToken())}),b.stop())},refs:{viewport:"viewport",navigationTree:"navigation-tree",navigationBreadcrumb:"#navigation-breadcrumb",
contentPanel:"contentPanel",contentTabsView:"#contentTabsView",thumbnailsTab:"#thumbnailsTab",thumbnails:"thumbnails"},handleRoute:function(a){var b=this.getNavigationTree(),c=this.getNavigationBreadcrumb();a=Ext.StoreMgr.get("navigation").getNodeById(a);this.getContentPanel();var d=this.getContentTabsView();thumbnailsTab=this.getThumbnailsTab();thumbnails=this.getThumbnails();hasTree=b&&b.isVisible();Ext.suspendLayouts();if(a.isLeaf()){hasTree||d.items.each(function(a){"thumbnailsTab"!=a.getItemId()&&
d.remove(a,!0)});var f=d.items.get(a.get("id"));f||(f=d.add({itemId:a.get("id"),title:a.get("text"),iconCls:a.get("iconCls"),items:[this.createTabItem(a)]}));d.setActiveTab(f)}else thumbnailsTab.treeNode=a,thumbnailsTab.setTitle(a.get("text")),thumbnailsTab.setIconCls(a.get("iconCls")),d.setActiveTab(thumbnailsTab),f=Ext.StoreMgr.get("Thumbnails"),f.removeAll(),f.add(a.childNodes);this.updateTitle(a);Ext.resumeLayouts(!0);hasTree?(b.setSelection(a),a.isRoot()?b.ensureVisible(0,{focus:!0}):b.ensureVisible(a,
{focus:!0,select:!0})):c&&(c.setSelection(a),c.child(":last").focus())},createTabItem:function(a){return{xtype:"panel",html:a.get("text"),bodyCls:"oms-panel-body"}},updateTitle:function(a){a=a.get("text");document.title=document.title.split(" - ")[0]+" - "+a}});Ext.define("Oms.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",control:{"navigation-tree":{selectionchange:"onTreeNavSelectionChange"},"navigation-toolbar breadcrumb":{change:"onBreadcrumbNavSelectionChange"},"#contentTabsView":{beforetabchange:"onTabchange"},thumbnails:{itemclick:"onThumbnailClick"}},navTreeTitleClick:function(){this.redirectTo("all")},applyState:function(a){var b=this.getReferences();void 0==a.hasTreeNav&&(a.hasTreeNav=!0);a.hasTreeNav||(Ext.getCmp("contentTabsView").getTabBar().hide(),
b["navigation-toolbar"].show(),b.tree.hide(),this._hasTreeNav=!1)},getState:function(){return{hasTreeNav:this._hasTreeNav}},onTabchange:function(a,b,c,d){"thumbnailsTab"==b.getItemId()?this.redirectTo(b.treeNode.get("id")):this.redirectTo(b.getItemId())},showBreadcrumbNav:function(){var a=this.getReferences(),b=a["navigation-toolbar"],c=a.tree;Ext.suspendLayouts();var d=Ext.getCmp("contentTabsView");d.getTabBar().hide();var f=d.getActiveTab();d.items.each(function(a){"thumbnailsTab"!=a.getItemId()&&
a.getItemId()!=f.getItemId()&&d.remove(a,!0)});b.show();c.hide();this._hasTreeNav=!1;this.getView().saveState();Ext.resumeLayouts(!0);a.breadcrumb.child(":last").focus()},showTreeNav:function(){var a=this.getReferences(),b=a.tree,c=a["navigation-toolbar"],a=a.breadcrumb.getSelection();Ext.suspendLayouts();Ext.getCmp("contentTabsView").getTabBar().show();b.show();c.hide();this._hasTreeNav=!0;this.getView().saveState();Ext.resumeLayouts(!0);a&&b.ensureVisible(a.isRoot()?b.store.getAt(0):a,{focus:!0})},
onTreeNavSelectionChange:function(a,b){var c=b[0];c&&!c.isRoot()&&this.redirectTo(c.getId())},onBreadcrumbNavSelectionChange:function(a,b){b&&this.redirectTo(b.getId())},onThumbnailClick:function(a,b,c,d,f){this.redirectTo(b.getId())},treeNavNodeRenderer:function(a){return this.rendererRegExp?a.replace(this.rendererRegExp,'<span style="color:red;font-weight:bold">$1</span>'):a},onNavFilterFieldChange:function(a,b){var c=this.getReferences().tree,d=this.getViewModel().get("selectedView");b?(this.preFilterSelection=
d,this.rendererRegExp=new RegExp("("+b+")","gi"),a.getTrigger("clear").show(),this.filterStore(b)):(this.rendererRegExp=null,c.store.clearFilter(),a.getTrigger("clear").hide(),d||(d=this.preFilterSelection),d&&c.ensureVisible(d,{select:!0}))},onNavFilterClearTriggerClick:function(){this.getReferences().navtreeFilter.setValue()},onNavFilterSearchTriggerClick:function(){var a=this.getReferences().navtreeFilter;this.onNavFilterFieldChange(a,a.getValue())},filterStore:function(a){var b=this.getReferences().tree.store;
a=a.toLowerCase();var c=function(a){var b=a.childNodes,g=b&&b.length;a=d.test(a.get("text"));var e;if(a)for(e=0;e<g;e++)b[e].set("visible",!0);else for(e=0;e<g&&!(a=b[e].isLeaf()?b[e].get("visible"):c(b[e]));e++);return a},d;1>a.length?b.clearFilter():(d=new RegExp(a,"i"),b.getFilters().replaceAll({filterFn:c}))}});Ext.define("Oms.main.MainView",{extend:"Ext.container.Viewport",controller:"main",viewModel:"main",layout:"border",stateful:!0,stateId:"oms-viewport",requires:["Oms.main.HeaderView","Oms.main.NavStore","Oms.main.NavTreeView","Oms.main.ContentPanelView","Oms.main.MainController"],items:[{region:"north",xtype:"appHeader"},{region:"west",reference:"tree",xtype:"navigation-tree"},{region:"center",xtype:"contentPanel",reference:"contentPanel",ariaRole:"main"}],applyState:function(a){this.getController().applyState(a)},
getState:function(){return this.getController().getState()},initComponent:function(){Ext.create("Oms.main.NavStore",{storeId:"navigation"});this.callParent()}});Ext.define("Oms.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{selectedView:!1}});Ext.enableAriaButtons=!1;Ext.Loader.setPath("Oms","app");Ext.Loader.setConfig({disableCaching:!1});Ext.define("Oms.Application",{extend:"Ext.app.Application",controllers:["Oms.main.GlobalController"],init:function(){this.setDefaultToken("all");Ext.tip.QuickTipManager.init();Ext.state.Manager.setProvider(Ext.create("Ext.state.CookieProvider"))},launch:function(){Ext.get("loading").hide();Ext.create("Oms.main.MainView")}});Ext.application({extend:"Oms.Application",name:"Oms"});
